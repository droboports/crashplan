language: c
compiler: gcc
os: linux
sudo: required

addons:
  apt:
    packages:
      - libc6:i386
      - libstdc++6:i386
      - libncurses5:i386
      - qemu-user-static
      - binfmt-support
      - php5-cli
      - unzip

cache:
  directories:
    - $HOME/xtools/toolchain/5n

install:
  - update-binfmts --display
  - sudo mkdir -p -m 777 /mnt/DroboFS/Shares/DroboApps
  - mkdir -p $HOME/xtools/toolchain/5n
  - if [ ! -f $HOME/xtools/toolchain/5n/SDK-2.1.zip ]; then
    wget -O $HOME/xtools/toolchain/5n/SDK-2.1.zip ftp://updates.drobo.com/droboapps/development/SDK-2.1.zip ;
    fi
  - if [ ! -f $HOME/xtools/toolchain/5n/arm7-tools.gz ]; then
    unzip -j $HOME/xtools/toolchain/5n/SDK-2.1.zip -d $HOME/xtools/toolchain/5n "DroboApps SDK 2.1/arm7-tools.gz" ;
    fi
  - if [ ! -d $HOME/xtools/toolchain/5n/bin ]; then
    tar -zxf $HOME/xtools/toolchain/5n/arm7-tools.gz -C $HOME/xtools/toolchain/5n ;
    fi
  - $HOME/xtools/toolchain/5n/bin/arm-marvell-linux-gnueabi-gcc --version

script: ./build.sh

after_failure: cat logfile_* | nc termbin.com 9999

after_success: curl -i -X POST -F "file=@$(ls *.tgz)" -F "expire=86400" -F "submit=Upload%20it!" http://tempsend.com/send

branches:
  only:
    - master
